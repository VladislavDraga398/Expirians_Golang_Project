# ADR 0002: Консистентность через оркестрацию саг

Status: **Accepted** • Date: 2025-09-27

## TL;DR
- Оркестрация саг в `OrderService` управляет шагами и компенсациями.
- Явный контроллер → легче тестировать, отслеживать и компенсировать ошибки.

## Контекст
- Заказ затрагивает несколько доменов (Order, Inventory, Payment) с частичными сбоями.
- Нужен явный контроль последовательности и надёжное восстановление.

## Решение
- Оркестратор в application-слое `OrderService` выполняет шаги (Reserve → Pay → Confirm) и компенсирует (Release, Cancel, Refund) при ошибках.

## Альтернативы
- **Choreography:** слабая связность, но сложная трассировка и компенсации.
- **TCC:** строгая семантика, требует поддержки Try/Confirm/Cancel у зависимостей.
- **Workflow Engine (Temporal и др.):** мощно для длительных процессов, но повышает операционные затраты.

## Последствия
- **Плюсы:** явный контроль, тестируемость, прозрачные компенсации, хорошая наблюдаемость.
- **Минусы:** оркестратор — потенциальная горячая точка, нужна идемпотентность и масштабирование.
