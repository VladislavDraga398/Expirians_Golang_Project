# Open Questions

> Открытые вопросы и нерешённые задачи

**Версия:** v2.0 | **Обновлено:** 2025-10-01 | **Статус:** Актуально

---

## TL;DR
- Используем статусы: Proposed → In review → Resolved (с ссылкой на ADR/PR).
- Отслеживаем вопросы по бизнес-правилам, платёжке, идемпотентности, outbox, SLO, безопасности и развертыванию.

Статусы: Proposed | In review | Resolved (ссылка на ADR/PR)
- Достаточно ли статусов `pending|reserved|paid|confirmed|canceled|refunded`? [Proposed]
- Отмена после оплаты всегда полный refund или поддерживаем частичный? [Proposed]

## Деньги и валюта
- Одна валюта на заказ (minor units)? Нужны ли налоги/комиссии сейчас? [Proposed]
- Проверять инвариант `amount = sum(items)` в приложении или триггерами БД? [Proposed]

## Инвентарь и резерв
- В MVP «всё-или-ничего» или частичный резерв? [Proposed]
- Операции склада идемпотентны по `order_id`? [In review]

## Платежи
- Провайдеры поддерживают Hold/Capture или только списание за один шаг? [In review]
- Идемпотентность у провайдеров через `idempotency-key`? [In review]

## Идемпотентность
- Обязательный ключ для всех мутаций? Разрешить автогенерацию сервером как фолбэк? [Proposed]
- TTL для ключей (24–72 ч)? [Proposed]

## Outbox и брокер
- Приемлемо at-least-once с дедупликацией на потребителях? [In review]
- Payload событий минимальный (ID + essentials) или обогащённый? [Proposed]

## Консистентность и конкуренция
- Достаточно ли optimistic locking при ожидаемой конкуренции? [In review]
- Один активный оркестратор на `order_id` (шардирование воркеров)? [In review]

## Экспонирование API
- Внешний API только gRPC в MVP или добавить REST через gateway? [Proposed]

## Наблюдаемость
- Семплинг трейсинга 1–5% + tail? [Proposed]

## SLO
- p95 CreateOrder ≤ 300 мс; E2E подтверждение ≤ 3 мин? [Proposed]

## Безопасность и приватность
- Внутри: mTLS; снаружи: JWT/OIDC (API Key для MVP)? [Proposed]
- В `orders` только `customer_id`; ПДн — вне ядра? [Proposed]

## CI/Тестирование
- Интеграционные тесты с реальными БД/брокером в CI приемлемы по времени? [In review]

## Развёртывание
- Достаточно Rolling updates; план на несовместимые миграции? [In review]

## Хранение
- TTL для `idempotency_keys` и `outbox`; политика архивации? [Proposed]

Используйте этот файл, чтобы отслеживать статус решений и добавлять ссылки на ADR/PR при закрытии вопросов.

