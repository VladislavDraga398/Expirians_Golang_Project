# üìä Observability

> –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥

**–í–µ—Ä—Å–∏—è:** v2.0 | **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-01 | **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω–æ

---

## üéØ TL;DR
- SLI/SLO: –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å 99.9%, `CreateOrder` p95 ‚â§ 300 –º—Å, E2E ‚â§ 3 –º–∏–Ω, –¥–æ—Å—Ç–∞–≤–∫–∏ Outbox ‚â• 99.5% –±–µ–∑ DLQ.
- –ú–µ—Ç—Ä–∏–∫–∏: RED+USE –¥–ª—è gRPC, —Å–∞–≥–∏, outbox, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.
- –õ–æ–≥–∏: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å `trace_id`, `order_id`, `saga_step`.
- –¢—Ä–µ–π—Å–∏–Ω–≥: –≤—Ö–æ–¥–Ω–æ–π RPC ‚Üí —à–∞–≥–∏ —Å–∞–≥–∏ ‚Üí –≤—ã–∑–æ–≤—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è.
- –ê–ª–µ—Ä—Ç—ã: error rate, p95, outbox backlog, DLQ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å/–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏, —Ç—Ä–µ–π—Å–∏–Ω–≥, SLI/SLO –∏ –∞–ª–µ—Ä—Ç—ã –¥–ª—è OMS.

## –ú–µ—Ç—Ä–∏–∫–∏ (–ø—Ä–∏–º–µ—Ä—ã)
- gRPC server
  - `rpc_server_requests_total{method,code}`
  - `rpc_server_latency_seconds{method}` (hist–æ–≥—Ä–∞–º–º–∞)
  - `rpc_server_inflight_requests{method}`
- gRPC client (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
  - `rpc_client_requests_total{dep}`
  - `rpc_client_latency_seconds{dep}`
  - —Å–æ—Å—Ç–æ—è–Ω–∏–µ circuit breaker, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ç—Ä–∞–µ–≤
- –°–∞–≥–∏/–±–∏–∑–Ω–µ—Å
  - `saga_step_duration_seconds{step}` (hist)
  - `saga_flow_transitions_total{from,to}`
  - `order_state_total{status}`
  - `order_e2e_latency_seconds` (hist)
- Outbox
  - `outbox_pending_records`
  - `outbox_oldest_pending_age_seconds`
  - `outbox_publish_attempts_total{result}`
  - `outbox_dlq_total`
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
  - `idempotency_conflicts_total`
  - `idempotency_processing_gauge`

## –õ–æ–≥–∏
- –ü–æ–ª—è JSON: `ts`, `level`, `logger`, `msg`, `trace_id`, `span_id`, `correlation_id`, `order_id`, `saga_step`, `status`, `duration_ms`, `err_code`, `err_detail`.
- –ü–æ–ª–∏—Ç–∏–∫–∞: Info –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤, Debug –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —à–∞–≥–æ–≤ (–ø–æ —Ñ–ª–∞–≥—É), Error –¥–ª—è —Ç–µ—Ö–æ—à–∏–±–æ–∫.

## –¢—Ä–µ–π—Å–∏–Ω–≥
- –°–ø–∞–Ω—ã: –≤—Ö–æ–¥–Ω–æ–π RPC, –∑–∞–ø–∏—Å—å –≤ –ë–î + outbox, —à–∞–≥–∏ —Å–∞–≥–∏, –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã, –ø—É–±–ª–∏–∫–∞—Ü–∏—è.
- –ê—Ç—Ä–∏–±—É—Ç—ã: `order.id`, `saga.step`, `retry.attempt`, `dep.name`.
- –°–µ–º–ø–ª–∏–Ω–≥: –±–∞–∑–æ–≤–æ 1‚Äì5%, tail-sampling –¥–ª—è –æ—à–∏–±–æ–∫/–º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## –î–∞—à–±–æ—Ä–¥—ã (–∏–¥–µ–∏)
- API Overview: RPS, error rate, p95/p99 –ø–æ –º–µ—Ç–æ–¥–∞–º.
- Sagas: –≤–æ—Ä–æ–Ω–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –¥–æ–ª—è cancel/refund, p95 —à–∞–≥–æ–≤.
- Outbox: pending, –≤–æ–∑—Ä–∞—Å—Ç —Å—Ç–∞—Ä–µ–π—à–µ–π –∑–∞–ø–∏—Å–∏, –ø–æ–ø—ã—Ç–∫–∏, –ø—Ä–∏—Ç–æ–∫ –≤ DLQ.
- Dependencies: –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –¥–æ–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ CB, —Ä–µ—Ç—Ä–∞–∏.
- Idempotency: –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, ¬´–¥–æ–ª–≥–æ processing¬ª –∫–ª—é—á–∏.

## –ê–ª–µ—Ä—Ç—ã (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ—Ä–æ–≥–∏)
- –û—à–∏–±–∫–∏ API > 2% (5 –º–∏–Ω), CreateOrder p95 > 600 –º—Å (10 –º–∏–Ω).
- E2E: –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–∞–≥ > 5% –∑–∞ 10 –º–∏–Ω.
- Outbox: –≤–æ–∑—Ä–∞—Å—Ç —Å—Ç–∞—Ä–µ–π—à–µ–≥–æ pending > 10 –º–∏–Ω; DLQ inflow > 5/–º–∏–Ω (–æ–∫–Ω–æ 5 –º–∏–Ω).
- Dependencies: CB –æ—Ç–∫—Ä—ã—Ç > 20% –≤—Ä–µ–º–µ–Ω–∏ (10 –º–∏–Ω); client error rate > 5% (5 –º–∏–Ω).
- Idempotency: processing-–∫–ª—é—á–∏ > –ø–æ—Ä–æ–≥–∞ –¥–æ–ª—å—à–µ 2 –º–∏–Ω.

## Health/Readiness
- Health –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ë–î, –±—Ä–æ–∫–µ—Ä, –±—ç–∫–ª–æ–≥ publisher).
- Readiness –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –±—ç–∫–ª–æ–≥–∞.

