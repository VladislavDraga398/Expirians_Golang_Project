# üìò Makefile Guide

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Makefile –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ OMS.

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å race detector
make test-race

# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
make build
make run
```

---

## üìö –†–∞–∑–¥–µ–ª—ã Makefile

### üîß –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make proto` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC/Protobuf –∫–æ–¥–∞ |
| `make generate` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∏—Å—Ç–æ—Ç—É git |
| `make tidy` | –û–±–Ω–æ–≤–∏—Ç—å go.mod –∏ go.sum |
| `make deps` | –°–∫–∞—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |

### üèóÔ∏è –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make build` | –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫ –≤ –ø–∞–ø–∫—É bin/ |
| `make run` | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞–ª—å–Ω–æ |

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make test` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã |
| `make test-v` | –¢–µ—Å—Ç—ã —Å verbose output |
| `make test-race` | **–¢–µ—Å—Ç—ã —Å race detector** ‚≠ê |
| `make test-race-v` | Race detector + verbose |

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make test-unit` | –¢–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã |
| `make test-integration` | –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| `make test-saga` | –¢–µ—Å—Ç—ã saga orchestrator |
| `make test-kafka` | –¢–µ—Å—Ç—ã Kafka integration |
| `make test-grpc` | –¢–µ—Å—Ç—ã gRPC service |

#### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make test-short` | –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–ª–∏–Ω–Ω—ã–µ) |
| `make test-count` | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã 10 —Ä–∞–∑ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏) |
| `make test-failfast` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ |

#### Coverage –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make cover` | –û—Ç—á—ë—Ç –ø–æ–∫—Ä—ã—Ç–∏—è (txt + HTML) |
| `make cover-race` | Coverage —Å race detector |
| `make bench` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |

### üîç –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make fmt` | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (gofmt) |
| `make vet` | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (go vet) |
| `make lint` | –ü–æ–ª–Ω—ã–π –ª–∏–Ω—Ç–∏–Ω–≥ |

### üê≥ Docker

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make docker-build` | –°–æ–±—Ä–∞—Ç—å Docker-–æ–±—Ä–∞–∑ |
| `make docker-run` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ |

### üêô Docker Compose

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make compose-up` | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç–µ–∫ |
| `make compose-down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–∫ |
| `make compose-build-up` | –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏ –ø–æ–¥–Ω—è—Ç—å —Å—Ç–µ–∫ |

### üé¨ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make demo` | –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω: build + compose + health + grpc |
| `make demo-run` | –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π —Å–∞–≥–∏ |
| `make demo-down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–º–æ-—Å—Ç–µ–∫ |
| `make demo-refund` | –î–µ–º–æ —Å RefundOrder |
| `make demo-success` | –î–µ–º–æ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è |
| `make load` | –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (100 req) |

### üßπ –£—Ç–∏–ª–∏—Ç—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `make clean` | –£–¥–∞–ª–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–±–æ—Ä–∫–∏ |
| `make help` | –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã |

---

## üî• –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å race conditions
make test-race

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage
make cover

# 3. –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make fmt
```

### –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
make test-saga

# Verbose output –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
make test-v

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
make test-failfast
```

### CI/CD

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make test-race && make cover && make lint
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–π —Ñ–∏—á–∏

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make compose-up

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
make run

# 3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - —Ç–µ—Å—Ç—ã
make test-saga

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å race conditions
make test-race
```

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ PR

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make test-race
make cover
make lint

# –ï—Å–ª–∏ –≤—Å—ë –û–ö - –∫–æ–º–º–∏—Ç
git add .
git commit -m "feat: add new feature"
```

### –ü—Ä–∏–º–µ—Ä 3: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω–æ–µ –¥–µ–º–æ
make demo

# –û—Ç–∫—Ä—ã—Ç—å Grafana
open http://localhost:3000

# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make load
```

---

## üé® –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Makefile

```
Makefile
‚îú‚îÄ‚îÄ üì¶ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
‚îú‚îÄ‚îÄ üéØ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´
‚îú‚îÄ‚îÄ üîß –ö–û–î–û–ì–ï–ù–ï–†–ê–¶–ò–Ø –ò –ó–ê–í–ò–°–ò–ú–û–°–¢–ò
‚îú‚îÄ‚îÄ üèóÔ∏è –°–ë–û–†–ö–ê –ò –ó–ê–ü–£–°–ö
‚îú‚îÄ‚îÄ üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
‚îÇ   ‚îú‚îÄ‚îÄ –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ Coverage –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏
‚îú‚îÄ‚îÄ üîç –õ–ò–ù–¢–ò–ù–ì –ò –°–¢–ê–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó
‚îú‚îÄ‚îÄ üê≥ DOCKER
‚îú‚îÄ‚îÄ üêô DOCKER COMPOSE
‚îú‚îÄ‚îÄ üé¨ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø
‚îî‚îÄ‚îÄ üßπ –£–¢–ò–õ–ò–¢–´
```

---

## ‚ö° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–ª–∏–∞—Å—ã)

–î–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

```bash
alias mt='make test'
alias mtr='make test-race'
alias mc='make cover'
alias ml='make lint'
alias md='make demo'
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
mtr  # –≤–º–µ—Å—Ç–æ make test-race
mc   # –≤–º–µ—Å—Ç–æ make cover
```

---

**–ì–æ—Ç–æ–≤–æ! Makefile –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.** üöÄ
