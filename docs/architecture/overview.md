# üèóÔ∏è Architecture

> –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Order Management System

**–í–µ—Ä—Å–∏—è:** v2.0 | **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-01 | **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω–æ

---

## üéØ TL;DR
- OMS ‚Äî –±—ç–∫–µ–Ω–¥ –¥–ª—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–∫–∞–∑–∞ —Å —è–≤–Ω–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π —Å–∞–≥.
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî gRPC; –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑ Outbox.
- –ß–∏—Å—Ç—ã–µ —Å–ª–æ–∏: Transport ‚Üí Application ‚Üí Domain ‚Üí Infrastructure.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `OrderService`: –ø—É–±–ª–∏—á–Ω—ã–π gRPC API, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∞–≥, –¥–æ—Å—Ç—É–ø –∫ –ë–î, Outbox.
- `InventoryService`: —Ä–µ–∑–µ—Ä–≤/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å—Ç–æ–∫–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π).
- `PaymentService`: Hold/Capture/Refund (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º).
- `NotificationService`: –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–∏—Å—Ç–µ–º—ã.
- –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (orders, items, payments, reservations, outbox, idempotency).
- –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

## –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–≤–Ω—É—Ç—Ä–∏/—Å–Ω–∞—Ä—É–∂–∏): gRPC —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏, —Ä–µ—Ç—Ä–∞—è–º–∏ (—Ç–æ–ª—å–∫–æ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ), circuit breaker.
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ): –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä (at-least-once; –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ).

## –°–ª–æ–∏
- Transport (gRPC)
- Application (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, use-cases)
- Domain (–∞–≥—Ä–µ–≥–∞—Ç—ã, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)
- Infrastructure (–ë–î, –±—Ä–æ–∫–µ—Ä, Outbox, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)

## –î–∏–∞–≥—Ä–∞–º–º–∞
```mermaid
flowchart LR
  Client -->|gRPC| OrderService
  OrderService -->|SQL| DB[(Relational DB)]
  OrderService -->|Publish Outbox| Broker[(Message Broker)]
  OrderService -->|gRPC| InventoryService
  OrderService -->|gRPC| PaymentService
  Broker -->|Events| NotificationService
```

## –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–∞–≥ —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è–º–∏ (—è–≤–Ω—ã–µ —à–∞–≥–∏, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –æ—à–∏–±–∫–∏).
- Transactional Outbox ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —Å —Ä–µ—Ç—Ä–∞—è–º–∏ –∏ DLQ.
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: `Idempotency-Key` –≤ gRPC metadata; –¥–µ–¥—É–ø –Ω–∞ consumer.
- Optimistic Locking (`orders.version`) –ø—Ä–æ—Ç–∏–≤ –≥–æ–Ω–æ–∫ –∑–∞–ø–∏—Å–µ–π.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–∫—Ä–∞—Ç–∫–æ)
- REST –≤–º–µ—Å—Ç–æ gRPC ‚Äî –ø—Ä–æ—â–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –≤–Ω–µ—à–Ω–∏—Ö, –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç.
- NATS JetStream –≤–º–µ—Å—Ç–æ Kafka/Redpanda ‚Äî –ø—Ä–æ—â–µ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –º–µ–Ω—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Ä–µ–ø–ª–µ—è.
- Workflow-–¥–≤–∏–∂–æ–∫ (Temporal) ‚Äî –º–æ—â–Ω–æ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è.

## –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ —Å–ª–æ—è–º –∏ —à–∞–≥–∞–º —Å–∞–≥: `docs/saga.md`
- –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç—É—Å—ã: `docs/data-model.md`
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã gRPC –∏ –æ—à–∏–±–∫–∏: `docs/api.md`
- Outbox –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏: `docs/outbox.md`

